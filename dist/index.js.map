{"version":3,"file":"index.js","sources":["../src/index.ts"],"sourcesContent":["export default function createAsyncCacher() {\n  const wm: WeakMap<Function, Map<number, any>> = new WeakMap();\n\n  return async <K = any>(fn: Function, ...args: any[]): Promise<K> => {\n    const hash = hashCode(args);\n\n    if (wm.has(fn)) {\n      const argMap = wm.get(fn);\n      if (argMap.has(hash)) return argMap.get(hash);\n      return argMap.set(hash, await fn(...args)).get(hash);\n    } else\n      return wm\n        .set(fn, new Map().set(hash, await fn(...args)))\n        .get(fn)\n        .get(hash);\n  };\n}\n\n// Same as Java's hashCode()\nfunction hashCode(...args: any[]) {\n  const json = JSON.stringify(args);\n\n  for (var i = 0, hashed = 0; i < json.length; i++)\n    hashed = (Math.imul(31, hashed) + json.charCodeAt(i)) | 0;\n\n  return hashed;\n}\n"],"names":["hashCode","json","JSON","stringify","i","hashed","length","Math","imul","charCodeAt","wm","WeakMap","fn","args","hash","has","argMap","get","set","Map","_Map2"],"mappings":"AAmBA,SAASA,IAGP,IAFA,IAAMC,EAAOC,KAAKC,oCAETC,EAAI,EAAGC,EAAS,EAAGD,EAAIH,EAAKK,OAAQF,IAC3CC,EAAUE,KAAKC,KAAK,GAAIH,GAAUJ,EAAKQ,WAAWL,GAAM,EAE1D,OAAOC,4BAxBP,IAAMK,EAA0C,IAAIC,QAEpD,gBAAuBC,WAAiBC,EAChCC,EAAOd,EADyBa,8BAGtC,GAAIH,EAAGK,IAAIH,GAAK,CACd,IAAMI,EAASN,EAAGO,IAAIL,GACtB,GAAII,EAAOD,IAAID,GAAO,uBAAOE,EAAOC,IAAIH,IAF1B,MAGPE,EAAOE,2BAAgBN,eAAMC,qBAApC,cAAOG,EAAWF,KAAyBG,IAAIH,WAExCJ,EACJQ,MAAQ,IAAIC,MAAJC,EAAUF,2BAAgBN,eAAMC,qBAD3C,cAAOH,EACAE,WAAkBE,MACtBG,IAAIL,GACJK,IAAIH,KAXX"}